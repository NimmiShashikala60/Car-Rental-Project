<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&family=Source+Sans+Pro:wght@300&display=swap"
          rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="assets/css/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="assets/css/style.css">

    <meta name="viewport" content="width=device-width initial-scale=1">
</head>
<body>
<div class="aside">
    <div class="logo">
        <a href="#"><span>C</span>ar Rental</a>
    </div>
    <div class="navbar-toggler">
        <span></span>

    </div>
    <ul class="nav">
        <li><a href="Admin-Information.html" class="active"><i class="fa fa-user"></i>Admin Information </a><li>
        <li><a href="Daily-Summery.html" class="active"><i class="fa fa-user"></i>Daily Summary </a><li>
        <li><a href="Car-Booking.html" class="active"><i class="fa fa-car"></i>Car Booking</a><li>
        <li><a href="Car-Routes.html" class="active"><i class="fa fa-car"></i>Car Routes</a><li>
        <li><a href="User-Information.html" class="active"><i class="fa fa-user"></i>User Information </a><li>
        <li><a href="Driver-Information.html" class="active"><i class="fa fa-car"></i>Driver Information </a><li>
        <li><a href="View-Schedule.html" class="active"><i class="fa fa-admin"></i>View Schedule </a><li>
        <li><a href="Income.html" class="active"><i class="fa fa-admin"></i>Income</a><li>


    </ul>
</div>
<div class="main-content d-flex w-100 justify-content-between align-items-center"></div>
<div class="main-content d-flex w-100 justify-content-between align-items-center"></div>
<div class="main-content d-flex w-100 justify-content-between align-items-center">
    <section class="w-25 h-100 p-5">
        <h4>User Information</h4>
        <form class="mt-2">

            <div class="mb-3">
                <label for="NIC" class="form-label">NIC:</label>
                <input type="text" class="form-control" id="NIC">
            </div>
            <div class="mb-3">
                <label for="Name" class="form-label">Name:</label>
                <input type="text" class="form-control" id="Name">
            </div>
            <div class="mb-3">
                <label for="Password" class="form-label">Password:</label>
                <input type="text" class="form-control" id="Password" aria-describedby="emailHelp">
            </div>
            <div class="mb-3">
                <label for="Email" class="form-label">Email:</label>
                <input type="text" class="form-control" id="Email" aria-describedby="emailHelp">
            </div>
            <div class="mb-3">
                <label for="ActiveDay" class="form-label">Contact Number:</label>
                <input type="text" class="form-control" id="ActiveDay" aria-describedby="emailHelp">
            </div>
            <div class="mb-3">
                <label for="Address" class="form-label">Address:</label>
                <input type="text" class="form-control" id="Address" aria-describedby="emailHelp">
            </div>
            <div class="mb-3 col col-5">
                <label for="BankName" class="form-label">Bank Name:</label>
                <input type="text" class="form-control" id="BankName" aria-describedby="emailHelp">
            </div>
            <div class="mb-3">
                <label for="Address" class="form-label">Payment:</label>
                <input type="text" class="form-control" id="Address" aria-describedby="emailHelp">
            </div>
            <section class="d-flex gap-2">
            <button type="button" class="btn btn-primary" id="Save">Save</button>
            <button type="button" class="btn btn-primary" id="Update">Update</button>
            <button type="button" class="btn btn-primary" id="GetAll">GetAll</button>
            <button type="button" class="btn btn-primary" id="Delete">Delete</button>
            </section>
        </form>

    </section>

    <section class="w-75">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">NIC</th>
                <th scope="col">Name</th>
                <th scope="col">Password</th>
                <th scope="col">Email</th>
                <th scope="col">Contact Number</th>
                <th scope="col">Address</th>
                <th scope="col">BankName</th>
                <th scope="col">Payment</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <th scope="row">1</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <th scope="row">2</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <th scope="row">3</th>
                <td colspan="2"></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <th scope="row">4</th>
                <td colspan="2"></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
    </section>

</div>
</div>
<script src="assets/js/js/bootstrap.min.js"></script>
<script src="assets/jquery-3.6.1.min.js"></script>
<script>
    let baseUrl="http://localhost:8080/car_rental/";
    loadAllUser();


            $("#UserInformation").on("click", function () {
                var formData = $("#UserInformation").serialize();
                $.ajax({
                    url: baseUrl + "customer",
                    method: "post",
                    data: formData,
                    dataType: "json",
                    success: function (res) {
                        alert(res.message);
                        loadAllUser();
                    },

                    error: function (error) {
                        var jsObject = JSON.parse(error.responseText);
                        alert(jsObject.message);
                    }
                });
            });


            $("#btnGetAll").click(function () {
                //send ajax request to the customer servlet
                loadAllUser();
            });
            $("#btnUserDelete").click(function () {
                let id = $("#txtUserID").val();
                $.ajax({
                    url: baseURL + "customer?id=" + NIC + "",
                    method: "delete",
                    dataType: "json",
                    success: function (resp) {
                        alert(resp.message);
                        loadAllUser();
                    },
                    error: function (error) {
                        alert(JSON.parse(error.responseText).message);
                    }
                });
            });
            $("#btnUpdate").click(function () {

                let UserNIC = $("#txtUserNIC").val();
                let UserName = $("#txtUserName").val();
                let UserPassword = $("#txtUserPassword").val();
                let UserContact = $("#txtUserContact").val();
                let UserAddress = $("#txtUserAddress").val();
                let UserBankName = $("#txtUserBankName").val();
                let UserPayment = $("#txtUserPayment").val();

                var User = {
                    id: UserNIC,
                    name: UserName,
                    password:UserPassword,
                    email: UserEmail,
                    contact: UserContact,
                    address: UserAddress,
                    bankname: UserBankName,
                    payment: UserPayment,
                }

                $.ajax({
                    url: baseURL + 'customer',
                    method: 'put',
                    contentType: "application/json",
                    data: JSON.stringify(User),
                    dataType: "json",
                    success: function (res) {
                        alert(res.message);
                        loadAllUser();
                    },
                    error: function (error) {
                        let cause = JSON.parse(error.responseText).message;
                        alert(cause);
                    }

                });
            });

            function loadAllUser() {
                $("#tblUser").empty();
                $.ajax({
                    url: baseURL + "customer",
                    dataType: "json",
                    success: function (resp) {
                        console.log(resp);
                        for (let usr of resp.data) {
                            var row = '<tr><td>' + usr.nic + '</td><td>' + usr.name + '</td><td>' + usr.password + '</td><td>' + usr.email + '</td></tr>' + usr.contact + '</td></tr>' + usr.address + '</td></tr>' + usr.bankname + '</td></tr>' + usr.payment + '</td></tr>';
                            $("#tblUser").append(row);
                        }
                        bindRowClickEvents();
                        setTextFieldValues("", "", "", "", "","","");
                        $("#txtUser").focus();
                    }
                });

            }

            function bindRowClickEvents() {
                $("#tblUser>tr").click(function () {
                    let id = $(this).children(":eq(0)").text();
                    let name = $(this).children(":eq(1)").text();
                    let password = $(this).children(":eq(2)").text();
                    let email = $(this).children(":eq(4)").text();
                    let contact = $(this).children(":eq(5)").text();
                    let address = $(this).children(":eq(6)").text();
                    let bankname = $(this).children(":eq(7)").text();
                    let payment = $(this).children(":eq(8)").text();

                    $('#txtUserNIC').val(nic);
                    $('#txtUserName').val(name);
                    $('#txtUserpassword').val(password);
                    $('#txtUserEmail').val(email);
                    $('#txtUserContact').val(contact);
                    $('#txtUseraddress').val(address);
                    $('#txtUserbankname').val(bankname);
                    $('#txtUserpayment').val(payment);

                });
            }

            function setTextFieldValues(id, name,password, email, contact, address, bankname, payment) {
                $("#txtUserID").val(id);
                $("#txtUserName").val(name);
                $("#txtUserpassword").val(password);
                $("#txtUseremail").val(email);
                $("#txtUserContact").val(contact);
                $("#txtUseraddress").val(address);
                $("#txtUserbankname").val(bankname);
                $("#txtUserpayment").val(payment);
            }
    $("#Save").on("click",function () {

        $.ajax({
            url:baseUrl+"user",
            method:"post",
            // dataType:"json",
            // contentType: "application/json",
            success:function () {
                alert("saved")
            }
        })

    })
</script>
</body>
</html>