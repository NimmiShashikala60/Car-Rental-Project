<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&family=Source+Sans+Pro:wght@300&display=swap"
        rel="stylesheet">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="assets/css/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="stylesheet" href="assets/css/style.css">

  <meta name="viewport" content="width=device-width initial-scale=1">
</head>
<body>
<div class="aside">
  <div class="logo">
    <a href="#"><span>C</span>ar Rental</a>
  </div>
  <div class="navbar-toggler">
    <span></span>

  </div>
  <ul class="nav">
    <li><a href="Admin-Information.html" class="active"><i class="fa fa-user"></i>Admin Information </a><li>
    <li><a href="Daily-Summery.html" class="active"><i class="fa fa-user"></i>Daily Summary </a><li>
    <li><a href="Car-Booking.html" class="active"><i class="fa fa-car"></i>Car Booking</a><li>
    <li><a href="Car-Routes.html" class="active"><i class="fa fa-car"></i>Car Routes</a><li>
    <li><a href="User-Information.html" class="active"><i class="fa fa-user"></i>User Information </a><li>
    <li><a href="Driver-Information.html" class="active"><i class="fa fa-car"></i>Driver Information </a><li>
    <li><a href="View-Schedule.html" class="active"><i class="fa fa-admin"></i>View Schedule </a><li>
    <li><a href="Income.html" class="active"><i class="fa fa-admin"></i>Income</a><li>

  </ul>
</div>

<div class="main-content d-flex w-100 justify-content-between align-items-center"></div>
<div class="main-content d-flex w-100 justify-content-between align-items-center">
  <section class="w-25 h-100 p-5">
    <h4>Daily Summery</h4>
    <form class="mt-2">
      <div class="mb-3">
        <label for="RegisteredUsers" class="form-label">User NIC:</label>
        <input type="text" class="form-control" name="UserNIC" id="UserNIC">
      </div>
      <div class="mb-3">
        <label for="ReservedCars" class="form-label">Vehicle Id:</label>
        <input type="text" class="form-control" name="VehicleId" id="VehicleId" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="BookingCar" class="form-label">Driver Id:</label>
        <input type="text" class="form-control" name="DriverId" id="DriverId" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="BookingCar" class="form-label">Occupied:</label>
        <input type="text" class="form-control" name="Occupied" id="Occupied" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="ActiveDay" class="form-label">Active Day:</label>
        <input type="text" class="form-control" name="ActiveDay" id="ActiveDay" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="ReservedCars" class="form-label">Reserved Car:</label>
        <input type="text" class="form-control" name="ReservedCar" id="ReservedCar" aria-describedby="emailHelp">
      </div>
      <section class="d-flex gap-2">
      <button type="button" class="btn btn-primary" id="Save">Save</button>
      <button type="button" class="btn btn-primary" id="Update">Update</button>
      <button type="button" class="btn btn-primary" id="GetAll">GetAll</button>
      <button type="button" class="btn btn-primary" id="Delete">Delete</button>
      </section>
    </form>

  </section>

  <section class="w-75">
    <table class="table">
      <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Users Id</th>
        <th scope="col">Vehicle Id</th>
        <th scope="col">Driver Id</th>
        <th scope="col">Occupied</th>
        <th scope="col">Active Day</th>
        <th scope="col">Reserved Car</th>
      </tr>
      </thead>
      <tbody id="tblDailySummery">

      </tbody>
    </table>
  </section>

</div>


<script src="assets/js/js/bootstrap.min.js"></script>
<script src="assets/jquery-3.6.1.min.js"></script>

<script>
  let baseUrl="http://localhost:8080/car_rental/";

  $("#DailySummery").on("click", function () {
    var formData = $("#DailySummery").serialize();
    $.ajax({
      url: baseUrl + "dailySummary",
      method: "post",
      data: formData,
      dataType: "json",
      success: function (res) {
        alert(res.massage);
        loadAllDailySummery();
      },

      error: function (error) {
        var jsObject = JSON.parse(error.responseText);
        alert(jsObject.massage);
      }
    });
  });


  $("#GetAll").click(function () {
    //send ajax request to the customer servlet
    loadAllDailySummery();
  });
  $("#Delete").click(function () {
    let id = $("#UserId").val();
    $.ajax({
      url: baseUrl+`user?id=${id}`,
      method: "delete",
      dataType:"json",
      success: function (resp) {
        alert(resp.massage);
        loadAllDailySummery();
      },
      error:function (error){
        alert(JSON.parse(error.responseText).massage);
      }
    });
  });
  $("#Update").click(function () {

    let UserId = $("#UserId").val();
    let VehicleId = $("#Vehicle Id").val();
    let DriverId = $("#DriverId").val();
    let Occupied = $("#Occupied").val();
    let ActiveDay = $("#ActiveDay").val();
    let ReservedCar = $("#ReservedCar").val();

    var Summery = {
      UserId: UserId,
      vehicleId:VehicleId,
      driverId:DriverId,
      occupied: Occupied,
      activeDay: ActiveDay,
      reservedCar: ReservedCar,
    }

    $.ajax({
      url: baseUrl+'DailySummery',
      method: 'put',
      contentType:"application/json",
      data:JSON.stringify(Summery),
      dataType:"json",
      success: function (res) {
        alert(res.massage);
        loadAllDailySummary();
      },
      error:function (error){
        let cause= JSON.parse(error.responseText).massage;
        alert(cause);
      }

    });
  });
  function loadAllDailySummery() {
    $("#tblDailySummery").empty();
    $.ajax({
      url: baseUrl+"dailySummery",
      dataType: "json",
      success: function (resp) {
        console.log(resp);
        for (let sum of resp.data) {
          var row = '<tr><td>' + sum.UserId + '</td><td>' + sum.VehicleId + '</td><td>' + sum.DriverId + '</td><td>' + sum.occupied + '</td></tr>'+ sum.activeDay + '</td></tr>'+sum.reservedCar + '</td></tr>';
          $("#tblDailySummery").append(row);
        }
        bindRowClickEvents();
        setTextFieldValues("","","","","","");
        $("#txtDailySummery").focus();
      }
    });

  }
  function bindRowClickEvents() {
    $("#tblDailySummery>tr").click(function () {
      let UserId = $(this).children(":eq(0)").text();
      let VehicleId = $(this).children(":eq(1)").text();
      let DriverId = $(this).children(":eq(2)").text();
      let Occupied = $(this).children(":eq(3)").text();
      let ActiveDay = $(this).children(":eq(4)").text();
      let ReservedCars = $(this).children(":eq(5)").text();

      $('#UserId').val(UserId);
      $('#VehicleId').val(VehicleId);
      $('#DriverId').val(DriverId);
      $('#Occupied').val(Occupied);
      $('#ActiveDay').val(ActiveDay);
      $('#ReservedCar').val(ReservedCars);

    });
  }
  function setTextFieldValues(UserId,VehicleId,DriverId,Occupied,ActiveDay,ReservedCar) {
    $("#UserId").val(UserId);
    $("#VehicleId").val(VehicleId);
    $("#DriverId").val(DriverId);
    $("#Occupied").val(Occupied);
    $("#ActiveDay").val(ActiveDay);
    $("#ReservedCar").val(ReservedCar);
  }

  $("#Save").on("click",function () {
    let formData = $("#DailySummeryForm").serialize();

    $.ajax({
      url:baseUrl+"summery",
      method:"post",
      data:formData,
      dataType:"json",
      // contentType: "application/json",
      success:function (res) {
        alert(res.massage)
      }
    })

  })
</script>
</body>
</html>