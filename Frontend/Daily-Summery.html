<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&family=Source+Sans+Pro:wght@300&display=swap"
        rel="stylesheet">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="assets/css/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="stylesheet" href="assets/css/style.css">

  <meta name="viewport" content="width=device-width initial-scale=1">
</head>
<body>
<div class="aside">
  <div class="logo">
    <a href="#"><span>C</span>ar Rental</a>
  </div>
  <div class="navbar-toggler">
    <span></span>

  </div>
  <ul class="nav">
    <li><a href="Admin-Information.html" class="active"><i class="fa fa-user"></i>Admin Information </a><li>
    <li><a href="Daily-Summery.html" class="active"><i class="fa fa-user"></i>Daily Summary </a><li>
    <li><a href="Car-Booking.html" class="active"><i class="fa fa-car"></i>Car Booking</a><li>
    <li><a href="Vehicle-Routes.html" class="active"><i class="fa fa-car"></i>Car Routes</a><li>
    <li><a href="User-Information.html" class="active"><i class="fa fa-user"></i>User Information </a><li>
    <li><a href="Driver-Information.html" class="active"><i class="fa fa-car"></i>Driver Information </a><li>
    <li><a href="View-Schedule.html" class="active"><i class="fa fa-admin"></i>View Schedule </a><li>
    <li><a href="Income.html" class="active"><i class="fa fa-admin"></i>Income</a><li>

  </ul>
</div>

<div class="main-content d-flex w-100 justify-content-between align-items-center"></div>
<div class="main-content d-flex w-100 justify-content-between align-items-center">
  <section class="w-25 h-100 p-5">
    <h4>Daily Summery</h4>
    <form class="mt-2" id="dailySummeryForm">
      <div class="mb-3">
        <label for="summeryId" class="form-label">Summery id:</label>
        <input type="text" class="form-control" name="summeryId" id="summeryId">
      </div>
      <div class="mb-3">
        <label for="userName" class="form-label">User Name:</label>
        <input type="text" class="form-control" name="userName" id="userName">
      </div>
      <div class="mb-3">
        <label for="vehicleId" class="form-label">Vehicle Id:</label>
        <input type="text" class="form-control" name="vehicleId" id="vehicleId" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="driverName" class="form-label">Driver Name:</label>
        <input type="text" class="form-control" name="driverName" id="driverName" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="occupied" class="form-label">Occupied:</label>
        <input type="text" class="form-control" name="occupied" id="occupied" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="activeDay" class="form-label">Active Day:</label>
        <input type="text" class="form-control" name="activeDay" id="activeDay" aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="reservedCar" class="form-label">Reserved Car:</label>
        <input type="text" class="form-control" name="reservedCar" id="reservedCar" aria-describedby="emailHelp">
      </div>
      <section class="d-flex gap-2">
      <button type="button" class="btn btn-primary" id="Save">Save</button>
      <button type="button" class="btn btn-primary" id="Update">Update</button>
      <button type="button" class="btn btn-primary" id="GetAll">GetAll</button>
      <button type="button" class="btn btn-primary" id="Delete">Delete</button>
      </section>
    </form>

  </section>

  <section class="w-75">
    <table class="table">
      <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Summery Id</th>
        <th scope="col">Users name</th>
        <th scope="col">Vehicle Id</th>
        <th scope="col">Driver name</th>
        <th scope="col">Occupied</th>
        <th scope="col">Active Day</th>
        <th scope="col">Reserved Car</th>
      </tr>
      </thead>
      <tbody id="tblDailySummery">

      </tbody>
    </table>
  </section>

</div>


<script src="assets/js/js/bootstrap.min.js"></script>
<script src="assets/jquery-3.6.1.min.js"></script>

<script>
  let baseUrl="http://localhost:8080/car_rental/";
  loadAllDailySummery();

  $("#DailySummery").on("click", function () {
    var formData = $("#DailySummery").serialize();
    $.ajax({
      url: baseUrl + "dailySummary",
      method: "post",
      data: formData,
      dataType: "json",
      success: function (res) {
        alert(res.massage);
        loadAllDailySummery();
      },

      error: function (error) {
        var jsObject = JSON.parse(error.responseText);
        alert(jsObject.massage);
      }
    });
  });


  $("#GetAll").click(function () {
    //send ajax request to the customer servlet
    loadAllDailySummery();
  });
  $("#Delete").click(function () {
    let id = $("#summeryId").val();
    $.ajax({
      url: baseUrl+`summery?id=${id}`,
      method: "delete",
      dataType:"json",
      success: function (resp) {
        alert(resp.massage);
        loadAllDailySummery();
      },
      error:function (error){
        alert(JSON.parse(error.responseText).massage);
      }
    });
  });
  $("#Update").click(function () {

    let SummeryId = $("#summeryId").val();
    let UserName = $("#userName").val();
    let VehicleId = $("#vehicleId").val();
    let DriverName = $("#driverName").val();
    let Occupied = $("#occupied").val();
    let ActiveDay = $("#activeDay").val();
    let ReservedCar = $("#reservedCar").val();

    var Summery = {
      summeryId:SummeryId,
      userName:UserName,
      vehicleId:VehicleId,
      driverName:DriverName,
      occupied: Occupied,
      activeDay: ActiveDay,
      reservedCar: ReservedCar,
    }

    $.ajax({
      url: baseUrl+'dailySummery',
      method: 'put',
      contentType:"application/json",
      data:JSON.stringify(Summery),
      dataType:"json",
      success: function (res) {
        alert(res.massage);
       loadAllDailySummery()
      },
      error:function (error){
        let cause= JSON.parse(error.responseText).massage;
        alert(cause);
      }

    });
  });
  function loadAllDailySummery() {
    $("#tblDailySummery").empty();
    $.ajax({
      url: baseUrl+"dailySummery",
      dataType: "json",
      success: function (resp) {
        console.log(resp);
        for (let sum of resp.data) {
          var row = '<tr><td>' + sum.summeryId +'<tr><td>' + sum.userName + '</td><td>' + sum.vehicleId + '</td><td>' + sum.driverName + '</td><td>' + sum.occupied + '</td></tr>'+ sum.activeDay + '</td></tr>'+sum.reservedCar + '</td></tr>';
          $("#tblDailySummery").append(row);
        }
        bindRowClickEvents();
        setTextFieldValues("","","","","","");
        $("#txtDailySummery").focus();
      }
    });

  }
  function bindRowClickEvents() {
    $("#tblDailySummery>tr").click(function () {
      let summeryId = $(this).children(":eq(0)").text();
      let userName = $(this).children(":eq(1)").text();
      let vehicleId = $(this).children(":eq(2)").text();
      let driverName = $(this).children(":eq(3)").text();
      let occupied = $(this).children(":eq(4)").text();
      let activeDay = $(this).children(":eq(5)").text();
      let reservedCars = $(this).children(":eq(6)").text();

      $('#SummeryId').val(summeryId);
      $('#UserName').val(userName);
      $('#VehicleId').val(vehicleId);
      $('#DriverName').val(driverName);
      $('#Occupied').val(occupied);
      $('#ActiveDay').val(activeDay);
      $('#ReservedCar').val(reservedCars);

    });
  }
  function setTextFieldValues(summeryId,userName,vehicleId,driverName,occupied,activeDay,reservedCar){
    $("#SummeryId").val(summeryId);
    $("#UserName").val(userName);
    $("#VehicleId").val(vehicleId);
    $("#DriverName").val(driverName);
    $("#Occupied").val(occupied);
    $("#ActiveDay").val(activeDay);
    $("#ReservedCar").val(reservedCar);
  }

  $("#Save").on("click",function () {
    let formData = $("#dailySummeryForm").serialize();

    $.ajax({
      url:baseUrl+"summery",
      method:"post",
      data:formData,
      dataType:"json",
      // contentType: "application/json",
      success:function (res) {
        alert(res.massage)
      }
    })

  })
</script>
</body>
</html>